#!/bin/bash
# Create a Central repo using Syncthing


# Install
{ 

  p syncthing
}  

# Configure
{  
  
  
  user='abz'

  sudo systemctl enable syncthing@"$user"

  sudo systemctl restart syncthing@"$user"

  sudo nano /home/"$user"/.config/syncthing/config.xml

  
  # change the address from 0.0.0.0 to the IP e.g: 10.0.0.101:8080
  
  #      <gui enabled="true" tls="false">
  #      <address>0.0.0.0:8080</address>

    
  


}


  
# Create Directories , NOTE : (On All Computers)
{

  # Home
  sudo mkdir /home/"$user"/Sync-Central-Repo
  
  
  
# Fix Permissions
  sudo chmod 777 /home/"$user"/Sync-Central-Repo
  sudo chmod -R 777 /usr/local/bin/
  
  
  ############### On the Clients Only ###############
  ############### On the Clients Only ###############
  # beware
  \#   sudo rm -r /usr/local/bin/*
  \#   sudo rm -r /usr/local/bin/.*
  # beware
  ############### On the Clients Only ###############
  ############### On the Clients Only ###############
  
  

# Start Services
  sudo systemctl enable syncthing@"$user"
  sudo systemctl restart syncthing@"$user"
  sudo systemctl status syncthing@"$user"

}

# Prepare the Sync Directories , NOTE : (On the Server Only)
{
  
  # Sync .zshrc
  mv /home/"$user"/.zshrc /home/"$user"/Sync-Central-Repo/
  ln -sf /home/"$user"/Sync-Central-Repo/.zshrc /home/"$user"/.zshrc
  sudo ln -sf /home/"$user"/Sync-Central-Repo/.zshrc /root/.zshrc
    
    
    
  # Sync .nanorc
  mv /home/"$user"/.nanorc /home/"$user"/Sync-Central-Repo/
  ln -sf /home/"$user"/Sync-Central-Repo/.nanorc /home/"$user"/.nanorc
  sudo ln -sf /home/"$user"/Sync-Central-Repo/.nanorc /root/.nanorc



  # Sync yaourtrc
  sudo mv /etc/yaourtrc  /home/"$user"/Sync-Central-Repo/
  sudo ln -sf /home/"$user"/Sync-Central-Repo/yaourtrc  /etc/yaourtrc
  
  
  # Sync hosts
  sudo mv /etc/hosts  /home/"$user"/Sync-Central-Repo/
  sudo ln -sf /home/"$user"/Sync-Central-Repo/hosts  /etc/hosts
  
  
  # Sync pacman.conf
  sudo mv /etc/pacman.conf  /home/"$user"/Sync-Central-Repo/
  sudo ln -sf /home/"$user"/Sync-Central-Repo/pacman.conf  /etc/pacman.conf

}

# Start the Sync Procedure
{

  Go to "host:8080" in your browser,
  
  Add the folders 
"  
/home/xxxx/Sync-Central-Repo
&
/usr/local/bin
"  

}

# Complete the Sync Process , NOTE : (On All Clients)
{

  user='abz'

  # Sync .zshrc
  sudo rm /home/"$user"/.zshrc
  sudo rm /root/.zshrc
  ln -sf /home/"$user"/Sync-Central-Repo/.zshrc /home/"$user"/.zshrc
  sudo ln -sf /home/"$user"/Sync-Central-Repo/.zshrc /root/.zshrc



  # Sync .nanorc
  sudo rm /home/"$user"/.nanorc
  sudo rm /root/.nanorc
  ln -sf /home/"$user"/Sync-Central-Repo/.nanorc /home/"$user"/.nanorc
  sudo ln -sf /home/"$user"/Sync-Central-Repo/.nanorc /root/.nanorc



  # Sync yaourtrc
  sudo rm /etc/yaourtrc  
  sudo ln -s /home/"$user"/Sync-Central-Repo/yaourtrc /etc/yaourtrc


  # Sync hosts
  sudo rm /etc/hosts
  sudo ln -s /home/"$user"/Sync-Central-Repo/hosts /etc/hosts


  # Sync pacman.conf
  sudo rm /etc/pacman.conf
  sudo ln -s /home/"$user"/Sync-Central-Repo/pacman.conf /etc/pacman.conf

}
