#!/bin/bash
# Installing Drupal and LAMP


#######################################################################

# Install packages
	
 p apache php-apache php-gd php-pear php-intl php-xcache mariadb \
 mariadb-clients libmariadbclient drupal


#######################################################################

# Configuring MariaDB for Drupal
{

	sudo systemctl restart mysqld
	
	sudo systemctl enable mysqld

	mysql_secure_installation	# Choose Y for default options
	
	mysql -u root -p

	# In MySQL console ,   MariaDB [(none)]>
	
	CREATE DATABASE drupal;

	# NOTE: change 'password' to the mysql root user password
	
	GRANT ALL ON drupal.* TO 'root'@'localhost' IDENTIFIED BY 'password';
		
	exit

}


#######################################################################

# Configuring php for Drupal
{
	
	n /etc/php/php.ini
	
	# Find the line open_basedir & Add the Drupal install directories
	
	#ABZ
	open_basedir = xxx:/usr/share/webapps/drupal:/var/lib/drupal:
	
	#SAL
	#open_basedir = xxx:/usr/share/webapps/drupal:/var/lib/drupal:/home/sal/TV:/media:

	
	
	# Make sure these are uncommented ; and add them if they dont exist
	extension=curl.so
	extension=gd.so
	extension=gettext.so
	extension=iconv.so
	extension=intl.so
	extension=mysqli.so
	extension=mysql.so
	extension=openssl.so
	extension=pdo_mysql.so
	extension=xmlrpc.so
	extension=zip.so
	extension=ixed.5.3
	extension=uploadprogress.so
	extension=xcache.so

	# configure the following options for upload cap size (all same same)
	post_max_size = 1000M
	upload_max_filesize = 1000M

	
	# Execute
	sudo pecl install uploadprogress


}	
	
	
#######################################################################
	
# Configuring Apache for Drupal
{
	
	n /etc/httpd/conf/httpd.conf
	
	
	# If your webserver is dedicated to Drupal , then Change
	
	DocumentRoot "/srv/http" >> DocumentRoot "/usr/share/webapps/drupal"

	Directory "/srv/http"  >>  Directory "/usr/share/webapps/drupal"


	# Add to the end of  /httpd.conf to run php
	
	LoadModule php5_module modules/libphp5.so
	Include conf/extra/php5_module.conf


############### Change this module #######################
##########################################################
LoadModule mpm_event_module modules/mod_mpm_event.so
############### With this one ############################
LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
##########################################################


}



#######################################################################

# Starting Services

 sudo systemctl enable mysqld
 sudo systemctl enable httpd
 sudo systemctl restart mysqld
 sudo systemctl restart httpd



#######################################################################

# Configuring Drupal Options

	Database name = "drupal"
	
	Database user = "root"
	
	Database password = "the root user mysql password"
	
	Site name = "whatever"
	
	Email = "whatever"
	
#######################################################################

# Resetting the Drupal admin password
	
	mysql -u root -p drupal


	# DO NOT CHANGE PARAMETERS , except 'name'
	#This will reset the password to "drupal"

UPDATE users SET name='abz', pass='$S$Drl0vgZ9yuU9uc4JyaTMHxMPriC7q/PsOUOx52fCrVQSTpI/Tu4x' WHERE uid = 1;


#######################################################################
	
# Resources

https://wiki.archlinux.org/index.php/drupal
https://wiki.archlinux.org/index.php/Apache
https://wiki.archlinux.org/index.php/MySQL
https://wiki.archlinux.org/index.php/PHP
