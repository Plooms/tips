
<p>
#!/bin/bash
# Install Archlinux from a running system
</p>
<hr />
<pre class="code"># Set The User Variable
MYUSER=&#039;sal&#039;

# Set the install Location Variable
INSTALL_POINT=&#039;/mnt/arch&#039;</pre>
<pre class="code"># Set The HDD Variables

HDD_MASTER=&#039;/dev/sdb&#039;</pre>
<pre class="code">HDD_ROOT=&#039;/dev/mapper/S0-ROOT&#039;</pre>
<pre class="code">HDD_BOOT=&#039;/dev/sdb5&#039;</pre>
<pre class="code">HDD_HOME=&#039;/dev/mapper/S0-HOME&#039;

HDD_VAR=&#039;/dev/mapper/S0-VAR&#039;

HDD_BIN=&#039;/dev/mapper/S0-BIN&#039;

HDD_WEBAPPS=&#039;&#039;</pre>
<pre class="code"># Set The Variables if using a Container
HDD_MASTER=&#039;/dev/loop1&#039;

HDD_ROOT=&#039;/dev/mapper/loop1p1&#039;</pre>
<hr />

<p>
# Install Arch Scripts
{ 
</p>

<p>
  sudo pacman -S –needed arch-install-scripts
</p>

<p>
}
</p>

<p>
# Check the partitions you want to install to
{
</p>
<pre class="code">sudo fdisk -l

# or

sudo lsblk -f</pre>

<p>
}
</p>

<p>
# Partition disks
{ 
</p>

<p>
  sudo cfdisk $HDD_MASTER
</p>

<p>
}
</p>

<p>
# Create a filesystem
{
</p>
<pre class="code">sudo mkfs.ext4 $HDD_ROOT</pre>
<pre class="code"># Optional
# Beware
# Be Careful (needed in new system only)</pre>

<p>
\# sudo mkfs.ext4 $HDD_BOOT 
\# sudo mkfs.ext4 $HDD_VAR
\# sudo mkfs.ext4 $HDD_BIN
\# sudo mkfs.ext4 $HDD_WEBAPPS
</p>
<pre class="code"># Optional
# Beware
# Be Careful (needed in new system only)</pre>

<p>
}
</p>

<p>
# mount $HDD_ROOT to /mnt (optionally, u need to mount /home /boot, to “$INSTALL_POINT”/home,boot)
{
</p>
<pre class="code">sudo mkdir -v &quot;$INSTALL_POINT&quot;
sudo mount $HDD_ROOT &quot;$INSTALL_POINT&quot;</pre>
<pre class="code">#Optional
sudo mkdir &quot;$INSTALL_POINT&quot;/boot
sudo mkdir &quot;$INSTALL_POINT&quot;/home
sudo mkdir &quot;$INSTALL_POINT&quot;/var
sudo mkdir -p &quot;$INSTALL_POINT&quot;/usr/local/bin
sudo mkdir -p &quot;$INSTALL_POINT&quot;/usr/share/webapps</pre>
<pre class="code">sudo mount $HDD_BOOT &quot;$INSTALL_POINT&quot;/boot/
sudo mount $HDD_HOME &quot;$INSTALL_POINT&quot;/home/
sudo mount $HDD_VAR &quot;$INSTALL_POINT&quot;/var
sudo mount $HDD_BIN &quot;$INSTALL_POINT&quot;/usr/local/bin
sudo mount $HDD_WEBAPPS &quot;$INSTALL_POINT&quot;/us/share/webapps</pre>

<p>
}
</p>

<p>
# Install the base system
{
</p>
<pre class="code">sudo pacstrap &quot;$INSTALL_POINT&quot;/ base base-devel grub-bios os-prober sudo openssh rsync yaourt</pre>

<p>
}
</p>

<p>
# generate the fstab
{
</p>
<pre class="code">su -c &quot;genfstab -pU &quot;$INSTALL_POINT&quot; &gt;&gt; &quot;$INSTALL_POINT&quot;/etc/fstab&quot;</pre>

<p>
}
</p>

<p>
# Update the system and clear the cache , to avoid cluttering the new installation
</p>
<pre class="code">sudo pacman -Syu ; sudo pacman -Sc</pre>

<p>
# Sync Packages to New system , to improve install speed
</p>
<pre class="code">sudo rsync -avhHP /var/cache/pacman/pkg/ &quot;$INSTALL_POINT&quot;/var/cache/pacman/pkg/</pre>

<p>
# copy the scripts to the new system
{
</p>
<pre class="code">sudo rsync -avuhHP /usr/local/bin/ &quot;$INSTALL_POINT&quot;/usr/local/bin/</pre>

<p>
} 
</p>

<p>
# copy the configs to the new system
{
</p>
<pre class="code">sudo rsync -avhHPL /etc/yaourtrc &quot;$INSTALL_POINT&quot;/etc/</pre>

<p>
  sudo rsync -avhHPL /etc/pacman.conf “$INSTALL_POINT”/etc/
</p>

<p>
  sudo rsync -avhHPL /etc/pacman.d/mirrorlist “$INSTALL_POINT”/etc/pacman.d/
</p>
<pre class="code">sudo rsync -avhHPL /etc/profile &quot;$INSTALL_POINT&quot;/etc/
 
sudo rsync -avhHPL /etc/modules-load.d/ &quot;$INSTALL_POINT&quot;/etc/modules-load.d/

sudo rsync -avhHPL /etc/ssh/ &quot;$INSTALL_POINT&quot;/etc/ssh/

sudo rsync -avhHPL /etc/slim.conf &quot;$INSTALL_POINT&quot;/etc/

sudo rsync -avhHPL /etc/openvpn/ &quot;$INSTALL_POINT&quot;/etc/openvpn/

sudo rsync -avhHPL /etc/hosts &quot;$INSTALL_POINT&quot;/etc/

sudo rsync -avhHPL /etc/bash.bashrc &quot;$INSTALL_POINT&quot;/etc/

sudo rsync -avhHPL /etc/resolv.conf &quot;$INSTALL_POINT&quot;/etc/

sudo rsync -avhHPL /home/&quot;$MYUSER&quot;/.zshrc &quot;$INSTALL_POINT&quot;/root/.zshrc</pre>

<p>
} 
</p>

<p>
# chroot into the new system
{
</p>

<p>
 sudo arch-chroot “$INSTALL_POINT”/
</p>

<p>
}
</p>
<hr />
<pre class="code"># Set The User Variable (in the Chroot)
MYUSER=&#039;sal&#039;

# Set The HDD Variables (in the Chroot)
HDD_MASTER=&#039;/dev/sdb&#039;

# Set The Container Variables (in the Chroot)
HDD_MASTER=&#039;/dev/loop3&#039;</pre>
<hr />

<p>
# Configure the system (Manually - enter each command individually)
{
</p>
<pre class="code">echo &quot;
en_US ISO-8859-1
en_US.UTF-8 UTF-8
ar_SA.UTF-8 UTF-8
ar_SA ISO-8859-6
&quot; &gt;&gt; /etc/locale.gen</pre>
<pre class="code">locale-gen</pre>

<p>
  export LANG=en_US.UTF-8
</p>

<p>
 # Optional
</p>
<pre class="code">nano /etc/mkinitcpio.conf # If using a seperate /boot ; mount it first;skip ths step if /boot is seperate &amp; not mounted</pre>

<p>
 # Required 
 #+ If using a seperate /boot ; mount it first;skip this step if /boot is in the same root &amp; not mounted
</p>
<pre class="code">passwd

mkinitcpio -p linux</pre>

<p>
  echo “%wheel ALL=(ALL) NOPASSWD: ALL” » /etc/sudoers
</p>
<pre class="code">useradd -G wheel -m -u 1000 -U -s /bin/bash $MYUSER</pre>

<p>
  sudo rsync -avhHPL /root/.zshrc /home/“$MYUSER”/
</p>

<p>
  passwd $MYUSER
</p>

<p>
} 
</p>

<p>
# Configure the system 
{ 
</p>
<pre class="code"># fix makepkg.conf (cores+1  -j2= 1 core)</pre>

<p>
 sudo nano /etc/makepkg.conf
</p>
<pre class="code"># Change -j2 to -j5 for Quad cores</pre>
<pre class="code"># Timezone
ln -s /usr/share/zoneinfo/Asia/Riyadh /etc/localtime</pre>
<pre class="code"># Xinitrc
echo &quot;exec dbus-launch startkde&quot; &gt; /home/&quot;$MYUSER&quot;/.xinitrc</pre>
<pre class="code">echo &quot;exec dbus-launch startkde&quot; &gt; /root/.xinitrc</pre>

<p>
}
</p>

<p>
# Initialize Pacman
{
</p>
<pre class="code">pacman-key --init; pacman-key --populate archlinux</pre>

<p>
}
</p>

<p>
# Install xorg - Nvidia - XFCE
{
</p>
<pre class="code">pacman --noconfirm -S --needed xorg xorg-apps xorg-drivers

pacman --noconfirm -R xf86-video-ati ; pacman --noconfirm -R ati-dri

pacman --noconfirm -R xf86-video-intel ; pacman --noconfirm -R intel-dri

pacman --noconfirm -R glamor-egl

pacman --noconfirm -R xf86-video-nouveau ; pacman --noconfirm -R nouveau-dri
  
pacman -S nvidia-340xx ; pacman -S --noconfirm --needed xfce4 xfce4-goodies</pre>

<p>
}
</p>

<p>
# edit ulimit
{
</p>

<p>
echo “
“$MYUSER”                  hard nofile 10000
“$MYUSER”                  soft nofile 10000
” » /etc/security/limits.conf
</p>

<p>
}
</p>

<p>
# Optional (disable systemd logging)
 sudo nano /etc/systemd/journald.conf
</p>
<pre class="code">  
  Storage=none
  
#    &quot;volatile&quot;, &quot;persistent&quot;, &quot;auto&quot; and &quot;none&quot;. If &quot;volatile&quot;,
#     journal log data will be stored only in memory, i.e. 
#     below the /run/log/journal hierarchy (which is created if needed). 
#     If &quot;persistent&quot;, data will be stored preferably on disk, i.e. 
#     below the /var/log/journal hierarchy (which is created if needed),
#     with a fallback to /run/log/journal (which is created if needed),
#     during early boot and if the disk is not writable. &quot;auto&quot; is 
#     similar to &quot;persistent&quot; but the directory /var/log/journal is
#     not created if needed, so that its existence controls where log
#     data goes. &quot;none&quot; turns off all storage, all log data received 
#     will be dropped. Forwarding to other targets, such as 
#     the console, the kernel log buffer or a syslog daemon will 
#     still work however. Defaults to &quot;auto&quot;.</pre>

<p>
# Optional ( mkdir /media/R1 + add to fstab)
{
</p>

<p>
mkdir /media/R1
</p>

<p>
# To prevent writing when unmounted (execute it while not mounted)
sudo chattr +i /media/R1
</p>

<p>
echo “
</p>

<p>
#NFS
#192.168.1.9:/mnt/S1 /media/S1 nfs4 auto,user,noatime 0 0
</p>

<p>
Gluster
C1:/R1    /media/R1       glusterfs       defaults        0 0
</p>

<p>
” » /etc/fstab
</p>

<p>
}
</p>

<p>
# Install Packages
{
</p>
<pre class="code"># Always Required
{</pre>

<p>
yaourt –noconfirm -S –needed arch-install-scripts reflector \
python2-gobject zsh dbus git slim x11vnc \
procmail bash-completion gnome-keyring seahorse wmctrl zenity \
gparted gpart sshfs terminator nano ntp dialog wget libnotify \
nfs-utils x2goserver x2goclient beep parallel
</p>
<pre class="code">}</pre>
<pre class="code"># Network
{</pre>

<p>
yaourt –noconfirm -S –needed networkmanager network-manager-applet \
networkmanager-pptp openvpn btsync btsync-autoconfig \
networkmanager-openvpn sshuttle kdeplasma-applets-networkmanagement
</p>
<pre class="code">}</pre>
<pre class="code"># CLI utils
{</pre>

<p>
yaourt –noconfirm -S –needed tree htop iotop nethogs nettop \
ncdu screen smartmontools iperf xclip
</p>
<pre class="code">}

  # File Systems
{</pre>

<p>
yaourt –noconfirm -S –needed dosfstools jfsutils \
exfat-utils e2fsprogs btrfs-progs reiserfsprogs xfsprogs ntfs-3g
</p>
<pre class="code">}</pre>
<pre class="code"># Router
{</pre>

<p>
yaourt –noconfirm -S –needed iptables squid
</p>
<pre class="code">}</pre>
<pre class="code"># Everyday Use (Main PC)
{</pre>

<p>
yaourt –noconfirm -S –needed firefox pidgin pidgin-libnotify dropbox \
flashplugin jre vidalia google-chrome onboard pkgfile redshift \
multipath-tools-git cryptsetup easystroke xbrightness xautomation \
xdotool kdenetwork-krdc gnome-themes-standard
</p>

<p>
# xte = xautomation
</p>
<pre class="code">}</pre>
<pre class="code"># Fonts
{</pre>

<p>
yaourt –noconfirm -S –needed ttf-amiri ttf-ms-fonts
</p>
<pre class="code">	#optional ttf-arabeyes-fonts (was broken last time)</pre>
<pre class="code">}</pre>
<pre class="code"># Editors &amp; Viewers
{</pre>

<p>
yaourt –noconfirm -S –needed kdesdk-kate kdegraphics-okular \
kdebase-kwrite geany geany-plugins libreoffice libreoffice-en-<abbr title="Gigabyte">GB</abbr> \
libreoffice-en-US
</p>
<pre class="code">}</pre>
<pre class="code"># Renamers
{</pre>

<p>
yaourt –noconfirm -S –needed pyrenamer tvnamer-git
</p>
<pre class="code">}</pre>
<pre class="code"># Language
{</pre>

<p>
yaourt –noconfirm -S –needed hyphen-en hunspell-en \
libreoffice-extension-languagetool 
</p>
<pre class="code">}</pre>
<pre class="code"># Encryption
{</pre>

<p>
yaourt –noconfirm -S –needed ecryptfs-utils encfs truecrypt
</p>
<pre class="code">}</pre>
<pre class="code"># Virtualization
{</pre>

<p>
yaourt –noconfirm -S –needed virtualbox virtualbox-host-modules \
virtualbox-guest-iso virtualbox-guest-utils virtualbox-guest-modules \
libvirt virt-manager
</p>
<pre class="code">}</pre>
<pre class="code"># Sound
{</pre>

<p>
yaourt –noconfirm -S –needed pulseaudio pulseaudio-alsa alsa-utils \
pavucontrol 
</p>
<pre class="code">}</pre>
<pre class="code"># Archiving
{</pre>

<p>
yaourt –noconfirm -S –needed unrar rar zip unzip file-roller 
</p>
<pre class="code">}</pre>
<pre class="code"># Imaging
{</pre>

<p>
yaourt –noconfirm -S –needed gimp
</p>
<pre class="code">}</pre>
<pre class="code"># Misc
{</pre>

<p>
yaourt –noconfirm -S –needed python-keybinder unetbootin 
</p>
<pre class="code">}</pre>
<pre class="code"># Media
{</pre>

<p>
yaourt –noconfirm -S –needed vlc xbmc lsb-release pms
</p>
<pre class="code">}</pre>
<pre class="code"># Video Codecs
{</pre>

<p>
yaourt –noconfirm -S –needed mencoder ffmpeg gstreamer0.10-plugins \
codecs64
</p>
<pre class="code">}</pre>
<pre class="code"># Video Editors &amp; Transcoders
{</pre>

<p>
yaourt –noconfirm -S –needed openshot handbrake
</p>
<pre class="code">}</pre>
<pre class="code"># p2p
{</pre>

<p>
yaourt –noconfirm -S –needed sabnzbd qbittorrent sickbeard-git \
couchpotato-git
</p>
<pre class="code">}</pre>
<pre class="code"># Webserver
{</pre>

<p>
yaourt –noconfirm -S –needed apache php php-apache mariadb
</p>
<pre class="code">}</pre>
<pre class="code"># The Mother load
{
  
	### Deprecated ###

}</pre>

<p>
}
</p>

<p>
# Enable Services
{
</p>
<pre class="code"># Needed
{

sudo systemctl enable kdm.service</pre>
<pre class="code">sudo systemctl enable NetworkManager.service
# If there is a Network auto mount only e.g (nfs or gluster)
sudo systemctl enable NetworkManager-wait-online.service</pre>
<pre class="code">sudo systemctl enable cronie.service</pre>
<pre class="code">sudo systemctl enable rpcbind.service</pre>
<pre class="code">sudo systemctl enable rpc-statd.service</pre>
<pre class="code">sudo systemctl enable sshd.service</pre>
<pre class="code">sudo systemctl enable ntpd.service

}</pre>
<pre class="code"># Optional Services
{

# Misc (speed boot up of apps on HDDs)
{</pre>
<pre class="code">sudo systemctl enable systemd-readahead-collect.service</pre>
<pre class="code">sudo systemctl enable systemd-readahead-replay.service</pre>
<pre class="code">} 

# Webserver 
{

sudo systemctl enable httpd.service</pre>
<pre class="code">}</pre>
<pre class="code"># Router
{</pre>
<pre class="code">sudo systemctl enable iptables.service</pre>
<pre class="code">sudo systemctl enable squid.service</pre>
<pre class="code">}</pre>
<pre class="code"># NAS
{</pre>
<pre class="code">sudo systemctl enable couchpotato.service</pre>
<pre class="code">sudo systemctl enable sickbeard.service</pre>
<pre class="code">sudo systemctl enable rpc-idmapd.service</pre>
<pre class="code">sudo systemctl enable rpc-mountd.service</pre>
<pre class="code">sudo systemctl enable lvm-monitoring.service</pre>
<pre class="code">sudo systemctl enable nfsd.service</pre>
<pre class="code">sudo systemctl enable mdadm.service</pre>
<pre class="code">}</pre>
<pre class="code"># Virtualbox Client
{</pre>
<pre class="code">sudo systemctl enable vboxservice.service</pre>
<pre class="code">}</pre>
<pre class="code">}</pre>

<p>
}
</p>

<p>
# Configure fstab again and make sure to add if missing /home &amp; /boot
{
</p>
<pre class="code">sudo blkid</pre>

<p>
  nano /etc/fstab
</p>

<p>
 #OPTIONAL: If genfstab didn&#039;t work
 # then, Add this if it is a container
 UUID=xxxxxxxxxxxxxxxxxxxxxxxx / ext4 rw,defaults 0 1
</p>

<p>
} 
</p>

<p>
# Install grub
{
</p>
<pre class="code">sudo grub-install $HDD_MASTER</pre>

<p>
 # if using a seperate /boot on the same computer, this is to be done in parent system
</p>
<pre class="code">sudo grub-mkconfig -o /boot/grub/grub.cfg    </pre>

<p>
}
</p>

<p>
# Change Shell
{
</p>

<p>
 # Change root shell
</p>
<pre class="code">chsh
 
 # New shell = /usr/bin/zsh</pre>

<p>
 # Change user shell
</p>
<pre class="code">su &quot;$MYUSER&quot; -c chsh

# New shell = /usr/bin/zsh</pre>

<p>
}
</p>

<p>
# exit the chroot
{ 
</p>

<p>
  exit
</p>

<p>
} 
</p>

<p>
# unmount the new system
{
</p>
<pre class="code">sudo umount -R &quot;$INSTALL_POINT&quot;/</pre>

<p>
}
</p>

<p>
#######################################################################
</p>

<p>
# Resources
</p>

<p>
<a href="https://wiki.archlinux.org/index.php/Installation_Guide" class="urlextern" title="https://wiki.archlinux.org/index.php/Installation_Guide"  rel="nofollow">https://wiki.archlinux.org/index.php/Installation_Guide</a>
<a href="https://wiki.archlinux.org/index.php/Beginners%27_Guide" class="urlextern" title="https://wiki.archlinux.org/index.php/Beginners%27_Guide"  rel="nofollow">https://wiki.archlinux.org/index.php/Beginners%27_Guide</a>
</p>
